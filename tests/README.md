# 測試程式目錄

這個目錄包含各種測試程式，用於驗證股票研究系統的各項功能。

## 測試程式列表

### 搜尋功能測試
- **`test-yahoo-search.js`** - 測試 Yahoo Finance 搜尋功能
  - 測試本地搜尋 vs Yahoo Finance 搜尋
  - 測試各種股票代碼和名稱的搜尋
  - 驗證搜尋結果的排序和來源標記

### 股票新增功能測試
- **`test-add-stocks.js`** - 測試批量新增股票到本地資料庫
  - 測試新增多支股票
  - 驗證重複股票的跳過邏輯
  - 驗證新增後的搜尋功能

- **`test-add-new-stock.js`** - 測試新增單一股票
  - 測試新增不存在的股票
  - 驗證新增前後的搜尋結果

- **`test-add-rare-stock.js`** - 測試新增非常不常見的股票
  - 使用測試股票代碼 ZTEST
  - 驗證完整的新增流程

### API 功能測試
- **`test-api.js`** - 綜合 API 測試
  - 測試所有 API 端點
  - 驗證錯誤處理
  - 測試資料格式

### 歷史資料測試
- **`test-historical.js`** - 測試歷史資料獲取
  - 測試不同時間範圍的資料獲取
  - 驗證資料格式和完整性

- **`test-historical-range.js`** - 測試歷史資料範圍
  - 測試 20 年歷史資料的獲取
  - 驗證資料的時間範圍

- **`test-paged-merge.js`** - 測試分頁資料合併
  - 測試分頁獲取歷史資料
  - 驗證資料合併和去重邏輯

### 特定股票測試
- **`test-2494.js`** - 測試特定股票 (2494 國碩)
  - 測試無資料股票的處理
  - 驗證錯誤訊息顯示

## 使用方法

### 執行單一測試
```bash
node tests/test-yahoo-search.js
node tests/test-add-stocks.js
```

### 執行所有測試
```bash
# 在 tests 目錄中執行所有測試
cd tests
for file in test-*.js; do
  echo "執行 $file..."
  node "$file"
  echo "---"
done
```

### 測試前準備
1. 確保伺服器正在運行 (`npm run dev`)
2. 確保伺服器監聽在 `http://localhost:3000`
3. 檢查網路連線（Yahoo Finance API 需要網路）

## 測試結果說明

### 成功標記
- ✅ - 測試成功
- ⚠️ - 警告（如股票已存在）
- ⏭️ - 跳過（如重複資料）

### 錯誤標記
- ❌ - 測試失敗
- HTTP 錯誤 - API 請求失敗
- 網路錯誤 - 連線問題

## 注意事項

1. **伺服器依賴**: 所有測試都需要伺服器運行
2. **網路依賴**: Yahoo Finance 相關測試需要網路連線
3. **資料變更**: 新增股票測試會修改 `data/stocks.json` 檔案
4. **重複執行**: 某些測試重複執行會跳過已存在的資料

## 維護說明

- 新增測試時，請在 README 中添加說明
- 測試程式應該獨立運行，不依賴其他測試
- 保持測試程式的可讀性和可維護性
- 定期更新測試以適應系統變更
