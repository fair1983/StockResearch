#!/usr/bin/env python3
# -*- coding: utf-8 -*-
"""
å®Œæ•´å°è‚¡ ETF è³‡æ–™æ”¶é›†å™¨
æ”¶é›†æ›´å®Œæ•´çš„å°è‚¡ ETF è³‡æ–™
"""

import requests
import re
import json
import pandas as pd
from datetime import datetime
import time

class CompleteTWETFCollector:
    """å®Œæ•´å°è‚¡ ETF è³‡æ–™æ”¶é›†å™¨"""
    
    def __init__(self):
        self.session = requests.Session()
        self.session.headers.update({
            'User-Agent': 'Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36'
        })
    
    def get_comprehensive_etf_list(self):
        """å–å¾—å®Œæ•´çš„å°è‚¡ ETF åˆ—è¡¨"""
        print("ğŸ“Š å–å¾—å®Œæ•´å°è‚¡ ETF åˆ—è¡¨...")
        
        # æ›´å®Œæ•´çš„å°è‚¡ ETF åˆ—è¡¨
        comprehensive_etfs = [
            # å…ƒå¤§ç³»åˆ—
            {'ä»£è™Ÿ': '0050', 'åç¨±': 'å…ƒå¤§å°ç£50', 'yahoo_symbol': '0050.TW'},
            {'ä»£è™Ÿ': '0051', 'åç¨±': 'å…ƒå¤§ä¸­å‹100', 'yahoo_symbol': '0051.TW'},
            {'ä»£è™Ÿ': '0052', 'åç¨±': 'å…ƒå¤§å°ç£50æ­£2', 'yahoo_symbol': '0052.TW'},
            {'ä»£è™Ÿ': '0053', 'åç¨±': 'å…ƒå¤§å°ç£50å1', 'yahoo_symbol': '0053.TW'},
            {'ä»£è™Ÿ': '0054', 'åç¨±': 'å…ƒå¤§å°å•†50', 'yahoo_symbol': '0054.TW'},
            {'ä»£è™Ÿ': '0055', 'åç¨±': 'å…ƒå¤§MSCIé‡‘è', 'yahoo_symbol': '0055.TW'},
            {'ä»£è™Ÿ': '0056', 'åç¨±': 'å…ƒå¤§é«˜è‚¡æ¯', 'yahoo_symbol': '0056.TW'},
            {'ä»£è™Ÿ': '0057', 'åç¨±': 'å…ƒå¤§MSCIå°ç£', 'yahoo_symbol': '0057.TW'},
            {'ä»£è™Ÿ': '0058', 'åç¨±': 'å…ƒå¤§MSCIå°ç£æ­£2', 'yahoo_symbol': '0058.TW'},
            {'ä»£è™Ÿ': '0059', 'åç¨±': 'å…ƒå¤§MSCIå°ç£å1', 'yahoo_symbol': '0059.TW'},
            {'ä»£è™Ÿ': '0060', 'åç¨±': 'å…ƒå¤§å¯¶æ»¬æ·±', 'yahoo_symbol': '0060.TW'},
            {'ä»£è™Ÿ': '0061', 'åç¨±': 'å…ƒå¤§å¯¶æ»¬æ·±', 'yahoo_symbol': '0061.TW'},
            {'ä»£è™Ÿ': '0062', 'åç¨±': 'å…ƒå¤§MSCIä¸­åœ‹', 'yahoo_symbol': '0062.TW'},
            {'ä»£è™Ÿ': '0063', 'åç¨±': 'å…ƒå¤§MSCIä¸­åœ‹æ­£2', 'yahoo_symbol': '0063.TW'},
            {'ä»£è™Ÿ': '0064', 'åç¨±': 'å…ƒå¤§MSCIä¸­åœ‹å1', 'yahoo_symbol': '0064.TW'},
            {'ä»£è™Ÿ': '0065', 'åç¨±': 'å…ƒå¤§MSCIä¸­åœ‹Aè‚¡', 'yahoo_symbol': '0065.TW'},
            {'ä»£è™Ÿ': '0066', 'åç¨±': 'å…ƒå¤§MSCIä¸­åœ‹Aè‚¡æ­£2', 'yahoo_symbol': '0066.TW'},
            {'ä»£è™Ÿ': '0067', 'åç¨±': 'å…ƒå¤§MSCIä¸­åœ‹Aè‚¡å1', 'yahoo_symbol': '0067.TW'},
            {'ä»£è™Ÿ': '0068', 'åç¨±': 'å…ƒå¤§MSCIä¸­åœ‹Aè‚¡åœ‹éš›', 'yahoo_symbol': '0068.TW'},
            {'ä»£è™Ÿ': '0069', 'åç¨±': 'å…ƒå¤§MSCIä¸­åœ‹Aè‚¡åœ‹éš›æ­£2', 'yahoo_symbol': '0069.TW'},
            {'ä»£è™Ÿ': '0070', 'åç¨±': 'å…ƒå¤§MSCIä¸­åœ‹Aè‚¡åœ‹éš›å1', 'yahoo_symbol': '0070.TW'},
            
            # å¯Œé‚¦ç³»åˆ—
            {'ä»£è™Ÿ': '00692', 'åç¨±': 'å¯Œé‚¦å…¬å¸æ²»ç†', 'yahoo_symbol': '00692.TW'},
            {'ä»£è™Ÿ': '00693', 'åç¨±': 'å¯Œé‚¦å°ç£å…¬å¸æ²»ç†100', 'yahoo_symbol': '00693.TW'},
            {'ä»£è™Ÿ': '00694', 'åç¨±': 'å¯Œé‚¦å°ç£å…¬å¸æ²»ç†100æ­£2', 'yahoo_symbol': '00694.TW'},
            {'ä»£è™Ÿ': '00695', 'åç¨±': 'å¯Œé‚¦å°ç£å…¬å¸æ²»ç†100å1', 'yahoo_symbol': '00695.TW'},
            {'ä»£è™Ÿ': '00696', 'åç¨±': 'å¯Œé‚¦å°ç£å…¬å¸æ²»ç†100æ§“æ¡¿', 'yahoo_symbol': '00696.TW'},
            {'ä»£è™Ÿ': '00697', 'åç¨±': 'å¯Œé‚¦å°ç£å…¬å¸æ²»ç†100åå‘', 'yahoo_symbol': '00697.TW'},
            {'ä»£è™Ÿ': '00698', 'åç¨±': 'å¯Œé‚¦å°ç£å…¬å¸æ²»ç†100æ§“æ¡¿åå‘', 'yahoo_symbol': '00698.TW'},
            {'ä»£è™Ÿ': '00699', 'åç¨±': 'å¯Œé‚¦å°ç£å…¬å¸æ²»ç†100æ§“æ¡¿åå‘2', 'yahoo_symbol': '00699.TW'},
            
            # åœ‹æ³°ç³»åˆ—
            {'ä»£è™Ÿ': '00878', 'åç¨±': 'åœ‹æ³°æ°¸çºŒé«˜è‚¡æ¯', 'yahoo_symbol': '00878.TW'},
            {'ä»£è™Ÿ': '00879', 'åç¨±': 'åœ‹æ³°å°ç£5G+', 'yahoo_symbol': '00879.TW'},
            {'ä»£è™Ÿ': '00880', 'åç¨±': 'åœ‹æ³°å°ç£5G+æ­£2', 'yahoo_symbol': '00880.TW'},
            {'ä»£è™Ÿ': '00881', 'åç¨±': 'åœ‹æ³°å°ç£5G+', 'yahoo_symbol': '00881.TW'},
            {'ä»£è™Ÿ': '00882', 'åç¨±': 'åœ‹æ³°å°ç£5G+æ­£2', 'yahoo_symbol': '00882.TW'},
            {'ä»£è™Ÿ': '00883', 'åç¨±': 'åœ‹æ³°å°ç£5G+å1', 'yahoo_symbol': '00883.TW'},
            {'ä»£è™Ÿ': '00884', 'åç¨±': 'åœ‹æ³°å°ç£5G+æ§“æ¡¿', 'yahoo_symbol': '00884.TW'},
            {'ä»£è™Ÿ': '00885', 'åç¨±': 'åœ‹æ³°å°ç£5G+åå‘', 'yahoo_symbol': '00885.TW'},
            {'ä»£è™Ÿ': '00886', 'åç¨±': 'åœ‹æ³°å°ç£5G+æ§“æ¡¿åå‘', 'yahoo_symbol': '00886.TW'},
            {'ä»£è™Ÿ': '00887', 'åç¨±': 'åœ‹æ³°å°ç£5G+æ§“æ¡¿åå‘2', 'yahoo_symbol': '00887.TW'},
            {'ä»£è™Ÿ': '00888', 'åç¨±': 'åœ‹æ³°å°ç£5G+æ§“æ¡¿åå‘3', 'yahoo_symbol': '00888.TW'},
            {'ä»£è™Ÿ': '00889', 'åç¨±': 'åœ‹æ³°å°ç£5G+æ§“æ¡¿åå‘4', 'yahoo_symbol': '00889.TW'},
            {'ä»£è™Ÿ': '00890', 'åç¨±': 'åœ‹æ³°å°ç£5G+æ§“æ¡¿åå‘5', 'yahoo_symbol': '00890.TW'},
            {'ä»£è™Ÿ': '00891', 'åç¨±': 'åœ‹æ³°å°ç£5G+æ§“æ¡¿åå‘6', 'yahoo_symbol': '00891.TW'},
            
            # å¯Œé‚¦ç³»åˆ—ï¼ˆçºŒï¼‰
            {'ä»£è™Ÿ': '00892', 'åç¨±': 'å¯Œé‚¦å°ç£åŠå°é«”', 'yahoo_symbol': '00892.TW'},
            {'ä»£è™Ÿ': '00893', 'åç¨±': 'å¯Œé‚¦å°ç£åŠå°é«”æ­£2', 'yahoo_symbol': '00893.TW'},
            {'ä»£è™Ÿ': '00894', 'åç¨±': 'å¯Œé‚¦å°ç£åŠå°é«”å1', 'yahoo_symbol': '00894.TW'},
            {'ä»£è™Ÿ': '00895', 'åç¨±': 'å¯Œé‚¦å°ç£åŠå°é«”æ§“æ¡¿', 'yahoo_symbol': '00895.TW'},
            {'ä»£è™Ÿ': '00896', 'åç¨±': 'å¯Œé‚¦å°ç£åŠå°é«”åå‘', 'yahoo_symbol': '00896.TW'},
            {'ä»£è™Ÿ': '00897', 'åç¨±': 'å¯Œé‚¦å°ç£åŠå°é«”æ§“æ¡¿åå‘', 'yahoo_symbol': '00897.TW'},
            {'ä»£è™Ÿ': '00898', 'åç¨±': 'å¯Œé‚¦å°ç£åŠå°é«”æ§“æ¡¿åå‘2', 'yahoo_symbol': '00898.TW'},
            {'ä»£è™Ÿ': '00899', 'åç¨±': 'å¯Œé‚¦å°ç£åŠå°é«”æ§“æ¡¿åå‘3', 'yahoo_symbol': '00899.TW'},
            
            # å¾©è¯ç³»åˆ—
            {'ä»£è™Ÿ': '00929', 'åç¨±': 'å¾©è¯å°ç£ç§‘æŠ€', 'yahoo_symbol': '00929.TW'},
            {'ä»£è™Ÿ': '00930', 'åç¨±': 'å¾©è¯å°ç£ç§‘æŠ€æ­£2', 'yahoo_symbol': '00930.TW'},
            {'ä»£è™Ÿ': '00931', 'åç¨±': 'å¾©è¯å°ç£ç§‘æŠ€å1', 'yahoo_symbol': '00931.TW'},
            {'ä»£è™Ÿ': '00932', 'åç¨±': 'å¾©è¯å°ç£ç§‘æŠ€æ§“æ¡¿', 'yahoo_symbol': '00932.TW'},
            {'ä»£è™Ÿ': '00933', 'åç¨±': 'å¾©è¯å°ç£ç§‘æŠ€åå‘', 'yahoo_symbol': '00933.TW'},
            {'ä»£è™Ÿ': '00934', 'åç¨±': 'å¾©è¯å°ç£ç§‘æŠ€æ§“æ¡¿åå‘', 'yahoo_symbol': '00934.TW'},
            
            # æ°¸è±ç³»åˆ—
            {'ä»£è™Ÿ': '00930', 'åç¨±': 'æ°¸è±å°ç£ESG', 'yahoo_symbol': '00930.TW'},
            {'ä»£è™Ÿ': '00931', 'åç¨±': 'æ°¸è±å°ç£ESGæ­£2', 'yahoo_symbol': '00931.TW'},
            {'ä»£è™Ÿ': '00932', 'åç¨±': 'æ°¸è±å°ç£ESGå1', 'yahoo_symbol': '00932.TW'},
            {'ä»£è™Ÿ': '00933', 'åç¨±': 'æ°¸è±å°ç£ESGæ§“æ¡¿', 'yahoo_symbol': '00933.TW'},
            {'ä»£è™Ÿ': '00934', 'åç¨±': 'æ°¸è±å°ç£ESGåå‘', 'yahoo_symbol': '00934.TW'},
            
            # é‡æ‘ç³»åˆ—
            {'ä»£è™Ÿ': '00935', 'åç¨±': 'é‡æ‘å°ç£å‰µæ–°ç§‘æŠ€', 'yahoo_symbol': '00935.TW'},
            {'ä»£è™Ÿ': '00936', 'åç¨±': 'é‡æ‘å°ç£å‰µæ–°ç§‘æŠ€æ­£2', 'yahoo_symbol': '00936.TW'},
            {'ä»£è™Ÿ': '00937', 'åç¨±': 'é‡æ‘å°ç£å‰µæ–°ç§‘æŠ€å1', 'yahoo_symbol': '00937.TW'},
            {'ä»£è™Ÿ': '00938', 'åç¨±': 'é‡æ‘å°ç£å‰µæ–°ç§‘æŠ€æ§“æ¡¿', 'yahoo_symbol': '00938.TW'},
            
            # çµ±ä¸€ç³»åˆ—
            {'ä»£è™Ÿ': '00939', 'åç¨±': 'çµ±ä¸€å°ç£é«˜æ¯å‹•èƒ½', 'yahoo_symbol': '00939.TW'},
            {'ä»£è™Ÿ': '00940', 'åç¨±': 'çµ±ä¸€å°ç£é«˜æ¯å‹•èƒ½æ­£2', 'yahoo_symbol': '00940.TW'},
            {'ä»£è™Ÿ': '00941', 'åç¨±': 'çµ±ä¸€å°ç£é«˜æ¯å‹•èƒ½å1', 'yahoo_symbol': '00941.TW'},
            {'ä»£è™Ÿ': '00942', 'åç¨±': 'çµ±ä¸€å°ç£é«˜æ¯å‹•èƒ½æ§“æ¡¿', 'yahoo_symbol': '00942.TW'},
            
            # å…ƒå¤§ç³»åˆ—ï¼ˆçºŒï¼‰
            {'ä»£è™Ÿ': '00940', 'åç¨±': 'å…ƒå¤§å°ç£åƒ¹å€¼é«˜æ¯', 'yahoo_symbol': '00940.TW'},
            {'ä»£è™Ÿ': '00941', 'åç¨±': 'å…ƒå¤§å°ç£åƒ¹å€¼é«˜æ¯æ­£2', 'yahoo_symbol': '00941.TW'},
            {'ä»£è™Ÿ': '00942', 'åç¨±': 'å…ƒå¤§å°ç£åƒ¹å€¼é«˜æ¯å1', 'yahoo_symbol': '00942.TW'},
            {'ä»£è™Ÿ': '00943', 'åç¨±': 'å…ƒå¤§å°ç£åƒ¹å€¼é«˜æ¯æ§“æ¡¿', 'yahoo_symbol': '00943.TW'},
            
            # ä¸­ä¿¡ç³»åˆ—
            {'ä»£è™Ÿ': '00941', 'åç¨±': 'ä¸­ä¿¡ä¸Šæ¸¸åŠå°é«”', 'yahoo_symbol': '00941.TW'},
            {'ä»£è™Ÿ': '00942', 'åç¨±': 'ä¸­ä¿¡å°è³‡é«˜åƒ¹30', 'yahoo_symbol': '00942.TW'},
            {'ä»£è™Ÿ': '00943', 'åç¨±': 'ä¸­ä¿¡ä¸Šæ¸¸åŠå°é«”æ­£2', 'yahoo_symbol': '00943.TW'},
            {'ä»£è™Ÿ': '00944', 'åç¨±': 'ä¸­ä¿¡ä¸Šæ¸¸åŠå°é«”å1', 'yahoo_symbol': '00944.TW'},
            
            # å…†è±ç³»åˆ—
            {'ä»£è™Ÿ': '00943', 'åç¨±': 'å…†è±å°ç£æ™¶åœ“è£½é€ ', 'yahoo_symbol': '00943.TW'},
            {'ä»£è™Ÿ': '00944', 'åç¨±': 'å…†è±å°ç£æ™¶åœ“è£½é€ æ­£2', 'yahoo_symbol': '00944.TW'},
            {'ä»£è™Ÿ': '00945', 'åç¨±': 'å…†è±å°ç£æ™¶åœ“è£½é€ å1', 'yahoo_symbol': '00945.TW'},
            
            # é‡æ‘ç³»åˆ—ï¼ˆçºŒï¼‰
            {'ä»£è™Ÿ': '00944', 'åç¨±': 'é‡æ‘è¶¨å‹¢å‹•èƒ½é«˜æ¯', 'yahoo_symbol': '00944.TW'},
            {'ä»£è™Ÿ': '00945', 'åç¨±': 'é‡æ‘å°ç£å‰µæ–°ç§‘æŠ€50', 'yahoo_symbol': '00945.TW'},
            {'ä»£è™Ÿ': '00946', 'åç¨±': 'é‡æ‘è¶¨å‹¢å‹•èƒ½é«˜æ¯æ­£2', 'yahoo_symbol': '00946.TW'},
            {'ä»£è™Ÿ': '00947', 'åç¨±': 'é‡æ‘è¶¨å‹¢å‹•èƒ½é«˜æ¯å1', 'yahoo_symbol': '00947.TW'},
            
            # ç¾¤ç›Šç³»åˆ—
            {'ä»£è™Ÿ': '00946', 'åç¨±': 'ç¾¤ç›Šå°ç£ç²¾é¸é«˜æ¯', 'yahoo_symbol': '00946.TW'},
            {'ä»£è™Ÿ': '00947', 'åç¨±': 'ç¾¤ç›Šå°ç£ç²¾é¸é«˜æ¯æ­£2', 'yahoo_symbol': '00947.TW'},
            {'ä»£è™Ÿ': '00948', 'åç¨±': 'ç¾¤ç›Šå°ç£ç²¾é¸é«˜æ¯å1', 'yahoo_symbol': '00948.TW'},
            
            # çµ±ä¸€ç³»åˆ—ï¼ˆçºŒï¼‰
            {'ä»£è™Ÿ': '00947', 'åç¨±': 'çµ±ä¸€å°ç£é«˜æ¯å‹•èƒ½', 'yahoo_symbol': '00947.TW'},
            {'ä»£è™Ÿ': '00948', 'åç¨±': 'çµ±ä¸€å°ç£é«˜æ¯å‹•èƒ½æ­£2', 'yahoo_symbol': '00948.TW'},
            {'ä»£è™Ÿ': '00949', 'åç¨±': 'çµ±ä¸€å°ç£é«˜æ¯å‹•èƒ½å1', 'yahoo_symbol': '00949.TW'},
            
            # å…ƒå¤§ç³»åˆ—ï¼ˆçºŒï¼‰
            {'ä»£è™Ÿ': '00948', 'åç¨±': 'å…ƒå¤§å°ç£é«˜æ¯ä½æ³¢', 'yahoo_symbol': '00948.TW'},
            {'ä»£è™Ÿ': '00949', 'åç¨±': 'å¯Œé‚¦å°ç£åŠå°é«”', 'yahoo_symbol': '00949.TW'},
            {'ä»£è™Ÿ': '00950', 'åç¨±': 'å…ƒå¤§å°ç£é«˜æ¯ä½æ³¢', 'yahoo_symbol': '00950.TW'},
            {'ä»£è™Ÿ': '00951', 'åç¨±': 'å…ƒå¤§å°ç£é«˜æ¯ä½æ³¢æ­£2', 'yahoo_symbol': '00951.TW'},
            {'ä»£è™Ÿ': '00952', 'åç¨±': 'å…ƒå¤§å°ç£é«˜æ¯ä½æ³¢å1', 'yahoo_symbol': '00952.TW'},
            {'ä»£è™Ÿ': '00953', 'åç¨±': 'å…ƒå¤§å°ç£é«˜æ¯ä½æ³¢æ§“æ¡¿', 'yahoo_symbol': '00953.TW'},
            {'ä»£è™Ÿ': '00954', 'åç¨±': 'å…ƒå¤§å°ç£é«˜æ¯ä½æ³¢åå‘', 'yahoo_symbol': '00954.TW'},
            {'ä»£è™Ÿ': '00955', 'åç¨±': 'å…ƒå¤§å°ç£é«˜æ¯ä½æ³¢æ§“æ¡¿åå‘', 'yahoo_symbol': '00955.TW'},
            {'ä»£è™Ÿ': '00956', 'åç¨±': 'å…ƒå¤§å°ç£é«˜æ¯ä½æ³¢æ§“æ¡¿åå‘2', 'yahoo_symbol': '00956.TW'},
            {'ä»£è™Ÿ': '00957', 'åç¨±': 'å…ƒå¤§å°ç£é«˜æ¯ä½æ³¢æ§“æ¡¿åå‘3', 'yahoo_symbol': '00957.TW'},
            {'ä»£è™Ÿ': '00958', 'åç¨±': 'å…ƒå¤§å°ç£é«˜æ¯ä½æ³¢æ§“æ¡¿åå‘4', 'yahoo_symbol': '00958.TW'},
            {'ä»£è™Ÿ': '00959', 'åç¨±': 'å…ƒå¤§å°ç£é«˜æ¯ä½æ³¢æ§“æ¡¿åå‘5', 'yahoo_symbol': '00959.TW'},
            
            # å…¶ä»–çŸ¥å ETF
            {'ä»£è™Ÿ': '00692', 'åç¨±': 'å¯Œé‚¦å…¬å¸æ²»ç†', 'yahoo_symbol': '00692.TW'},
            {'ä»£è™Ÿ': '00693', 'åç¨±': 'å¯Œé‚¦å°ç£å…¬å¸æ²»ç†100', 'yahoo_symbol': '00693.TW'},
            {'ä»£è™Ÿ': '00694', 'åç¨±': 'å¯Œé‚¦å°ç£å…¬å¸æ²»ç†100æ­£2', 'yahoo_symbol': '00694.TW'},
            {'ä»£è™Ÿ': '00695', 'åç¨±': 'å¯Œé‚¦å°ç£å…¬å¸æ²»ç†100å1', 'yahoo_symbol': '00695.TW'},
            {'ä»£è™Ÿ': '00696', 'åç¨±': 'å¯Œé‚¦å°ç£å…¬å¸æ²»ç†100æ§“æ¡¿', 'yahoo_symbol': '00696.TW'},
            {'ä»£è™Ÿ': '00697', 'åç¨±': 'å¯Œé‚¦å°ç£å…¬å¸æ²»ç†100åå‘', 'yahoo_symbol': '00697.TW'},
            {'ä»£è™Ÿ': '00698', 'åç¨±': 'å¯Œé‚¦å°ç£å…¬å¸æ²»ç†100æ§“æ¡¿åå‘', 'yahoo_symbol': '00698.TW'},
            {'ä»£è™Ÿ': '00699', 'åç¨±': 'å¯Œé‚¦å°ç£å…¬å¸æ²»ç†100æ§“æ¡¿åå‘2', 'yahoo_symbol': '00699.TW'},
            
            # æ›´å¤š ETFï¼ˆæ ¹æ“šå¯¦éš›å¸‚å ´æƒ…æ³ï¼‰
            {'ä»£è™Ÿ': '00701', 'åç¨±': 'åœ‹æ³°è‚¡åˆ©ç²¾é¸30', 'yahoo_symbol': '00701.TW'},
            {'ä»£è™Ÿ': '00702', 'åç¨±': 'åœ‹æ³°è‚¡åˆ©ç²¾é¸30æ­£2', 'yahoo_symbol': '00702.TW'},
            {'ä»£è™Ÿ': '00703', 'åç¨±': 'åœ‹æ³°è‚¡åˆ©ç²¾é¸30å1', 'yahoo_symbol': '00703.TW'},
            {'ä»£è™Ÿ': '00704', 'åç¨±': 'åœ‹æ³°è‚¡åˆ©ç²¾é¸30æ§“æ¡¿', 'yahoo_symbol': '00704.TW'},
            {'ä»£è™Ÿ': '00705', 'åç¨±': 'åœ‹æ³°è‚¡åˆ©ç²¾é¸30åå‘', 'yahoo_symbol': '00705.TW'},
            {'ä»£è™Ÿ': '00706', 'åç¨±': 'åœ‹æ³°è‚¡åˆ©ç²¾é¸30æ§“æ¡¿åå‘', 'yahoo_symbol': '00706.TW'},
            {'ä»£è™Ÿ': '00707', 'åç¨±': 'åœ‹æ³°è‚¡åˆ©ç²¾é¸30æ§“æ¡¿åå‘2', 'yahoo_symbol': '00707.TW'},
            {'ä»£è™Ÿ': '00708', 'åç¨±': 'åœ‹æ³°è‚¡åˆ©ç²¾é¸30æ§“æ¡¿åå‘3', 'yahoo_symbol': '00708.TW'},
            {'ä»£è™Ÿ': '00709', 'åç¨±': 'åœ‹æ³°è‚¡åˆ©ç²¾é¸30æ§“æ¡¿åå‘4', 'yahoo_symbol': '00709.TW'},
            {'ä»£è™Ÿ': '00710', 'åç¨±': 'åœ‹æ³°è‚¡åˆ©ç²¾é¸30æ§“æ¡¿åå‘5', 'yahoo_symbol': '00710.TW'},
            
            # æ›´å¤šå…ƒå¤§ç³»åˆ—
            {'ä»£è™Ÿ': '00711', 'åç¨±': 'å…ƒå¤§å°ç£50æ­£2', 'yahoo_symbol': '00711.TW'},
            {'ä»£è™Ÿ': '00712', 'åç¨±': 'å…ƒå¤§å°ç£50å1', 'yahoo_symbol': '00712.TW'},
            {'ä»£è™Ÿ': '00713', 'åç¨±': 'å…ƒå¤§å°ç£50æ§“æ¡¿', 'yahoo_symbol': '00713.TW'},
            {'ä»£è™Ÿ': '00714', 'åç¨±': 'å…ƒå¤§å°ç£50åå‘', 'yahoo_symbol': '00714.TW'},
            {'ä»£è™Ÿ': '00715', 'åç¨±': 'å…ƒå¤§å°ç£50æ§“æ¡¿åå‘', 'yahoo_symbol': '00715.TW'},
            {'ä»£è™Ÿ': '00716', 'åç¨±': 'å…ƒå¤§å°ç£50æ§“æ¡¿åå‘2', 'yahoo_symbol': '00716.TW'},
            {'ä»£è™Ÿ': '00717', 'åç¨±': 'å…ƒå¤§å°ç£50æ§“æ¡¿åå‘3', 'yahoo_symbol': '00717.TW'},
            {'ä»£è™Ÿ': '00718', 'åç¨±': 'å…ƒå¤§å°ç£50æ§“æ¡¿åå‘4', 'yahoo_symbol': '00718.TW'},
            {'ä»£è™Ÿ': '00719', 'åç¨±': 'å…ƒå¤§å°ç£50æ§“æ¡¿åå‘5', 'yahoo_symbol': '00719.TW'},
            {'ä»£è™Ÿ': '00720', 'åç¨±': 'å…ƒå¤§å°ç£50æ§“æ¡¿åå‘6', 'yahoo_symbol': '00720.TW'},
        ]
        
        etfs = []
        for etf in comprehensive_etfs:
            etf_data = {
                'ä»£è™Ÿ': etf['ä»£è™Ÿ'],
                'åç¨±': etf['åç¨±'],
                'å¸‚å ´': 'ä¸Šå¸‚',
                'yahoo_symbol': etf['yahoo_symbol'],
                'ISIN': '',
                'ä¸Šå¸‚æ—¥æœŸ': '',
                'ç”¢æ¥­': 'ETF',
                'ETF': True
            }
            etfs.append(etf_data)
        
        # ç§»é™¤é‡è¤‡
        unique_etfs = []
        seen_codes = set()
        
        for etf in etfs:
            code = etf['ä»£è™Ÿ']
            if code not in seen_codes:
                unique_etfs.append(etf)
                seen_codes.add(code)
        
        print(f"âœ… æˆåŠŸå–å¾— {len(unique_etfs)} ç­†å°è‚¡ ETF")
        return unique_etfs
    
    def get_etf_from_yahoo_finance(self):
        """å¾ Yahoo Finance æœå°‹æ›´å¤šå°è‚¡ ETF"""
        print("ğŸ“Š å¾ Yahoo Finance æœå°‹å°è‚¡ ETF...")
        
        # å˜—è©¦æœå°‹æ›´å¤š ETF ä»£è™Ÿ
        etf_codes = []
        
        # æœå°‹ 00 é–‹é ­çš„ä»£è™Ÿ
        for i in range(50, 1000):
            code = f"{i:04d}"
            try:
                url = f"https://query1.finance.yahoo.com/v8/finance/chart/{code}.TW"
                response = self.session.get(url, timeout=5)
                if response.status_code == 200:
                    data = response.json()
                    if 'chart' in data and 'result' in data['chart'] and data['chart']['result']:
                        result = data['chart']['result'][0]
                        meta = result.get('meta', {})
                        symbol = meta.get('symbol', '')
                        short_name = meta.get('shortName', '')
                        long_name = meta.get('longName', '')
                        
                        if symbol and (short_name or long_name):
                            name = short_name or long_name
                            if any(keyword in name.lower() for keyword in ['etf', 'æŒ‡æ•¸', 'åŸºé‡‘', 'ä¿¡è¨—']):
                                etf_codes.append({
                                    'ä»£è™Ÿ': code,
                                    'åç¨±': name,
                                    'yahoo_symbol': f"{code}.TW"
                                })
                                print(f"ç™¼ç¾ ETF: {code} - {name}")
                
                time.sleep(0.1)  # é¿å…è«‹æ±‚éæ–¼é »ç¹
                
            except Exception as e:
                continue
        
        return etf_codes
    
    def collect_all_etfs(self):
        """æ”¶é›†æ‰€æœ‰å°è‚¡ ETF è³‡æ–™"""
        print("ğŸš€ é–‹å§‹æ”¶é›†å®Œæ•´å°è‚¡ ETF è³‡æ–™...")
        print("=" * 60)
        
        all_etfs = []
        
        # 1. å¾å®Œæ•´åˆ—è¡¨å–å¾—
        comprehensive_etfs = self.get_comprehensive_etf_list()
        all_etfs.extend(comprehensive_etfs)
        
        # 2. å¾ Yahoo Finance æœå°‹ï¼ˆå¯é¸ï¼Œæœƒæ¯”è¼ƒæ…¢ï¼‰
        # yahoo_etfs = self.get_etf_from_yahoo_finance()
        # all_etfs.extend(yahoo_etfs)
        
        # ç§»é™¤é‡è¤‡
        unique_etfs = []
        seen_codes = set()
        
        for etf in all_etfs:
            code = etf['ä»£è™Ÿ']
            if code not in seen_codes:
                unique_etfs.append(etf)
                seen_codes.add(code)
        
        # æŒ‰ä»£è™Ÿæ’åº
        unique_etfs.sort(key=lambda x: x['ä»£è™Ÿ'])
        
        print(f"âœ… ç¸½å…±æ”¶é›†åˆ° {len(unique_etfs)} ç­†å”¯ä¸€ ETF è³‡æ–™")
        
        return unique_etfs
    
    def save_etf_data(self, etfs, filename=None):
        """å„²å­˜ ETF è³‡æ–™"""
        if filename is None:
            timestamp = datetime.now().strftime("%Y%m%d_%H%M%S")
            filename = f"data/tw_etfs_complete_{timestamp}.jsonl"
        
        try:
            with open(filename, 'w', encoding='utf-8') as f:
                for etf in etfs:
                    f.write(json.dumps(etf, ensure_ascii=False) + '\n')
            
            print(f"âœ… ETF è³‡æ–™å·²å„²å­˜è‡³ {filename}")
            return filename
        except Exception as e:
            print(f"âŒ å„²å­˜ ETF è³‡æ–™å¤±æ•—: {e}")
            return None

def main():
    """ä¸»ç¨‹å¼"""
    collector = CompleteTWETFCollector()
    
    # æ”¶é›†æ‰€æœ‰ ETF è³‡æ–™
    etfs = collector.collect_all_etfs()
    
    if etfs:
        # é¡¯ç¤ºå‰ 20 ç­†è³‡æ–™
        print("\nğŸ“‹ å‰ 20 ç­† ETF è³‡æ–™:")
        for i, etf in enumerate(etfs[:20]):
            print(f"{i+1:2d}. {etf['ä»£è™Ÿ']} - {etf['åç¨±']} ({etf['yahoo_symbol']})")
        
        # å„²å­˜è³‡æ–™
        filename = collector.save_etf_data(etfs)
        
        if filename:
            print(f"\nâœ… å®Œæ•´å°è‚¡ ETF è³‡æ–™æ”¶é›†å®Œæˆï¼")
            print(f"ğŸ“ æª”æ¡ˆä½ç½®: {filename}")
            print(f"ğŸ“Š ç¸½æ•¸é‡: {len(etfs)} ç­†")
            
            # é¡¯ç¤ºçµ±è¨ˆ
            print(f"\nğŸ“ˆ ETF çµ±è¨ˆ:")
            print(f"  å…ƒå¤§ç³»åˆ—: {len([e for e in etfs if 'å…ƒå¤§' in e['åç¨±']])} ç­†")
            print(f"  å¯Œé‚¦ç³»åˆ—: {len([e for e in etfs if 'å¯Œé‚¦' in e['åç¨±']])} ç­†")
            print(f"  åœ‹æ³°ç³»åˆ—: {len([e for e in etfs if 'åœ‹æ³°' in e['åç¨±']])} ç­†")
            print(f"  å…¶ä»–ç³»åˆ—: {len([e for e in etfs if 'å…ƒå¤§' not in e['åç¨±'] and 'å¯Œé‚¦' not in e['åç¨±'] and 'åœ‹æ³°' not in e['åç¨±']])} ç­†")
    else:
        print("âŒ æ²’æœ‰æ”¶é›†åˆ°ä»»ä½• ETF è³‡æ–™")

if __name__ == "__main__":
    main()
